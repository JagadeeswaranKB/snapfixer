name: snapfixer
services:
  - name: web
    type: docker
    imageUri: .
    ports:
      - port: 8000
        protocol: http
    env:
      - key: DEBUG
        value: "0"
      - key: ALLOWED_HOSTS
        value: "*"
      - key: PORT
        value: "8000"
      - key: SECRET_KEY
        value: "{{ secret.SECRET_KEY }}"
      - key: DATABASE_URL
        value: "{{ secret.DATABASE_URL }}"
      - key: REDIS_URL
        value: "{{ secret.REDIS_URL }}"
    instance_type: nano
    health_checks:
      - http:
          path: /
          port: 8000
    regions:
      - fra
  - name: worker
    type: docker
    imageUri: .
    command: celery -A validphoto worker -l info --pool=solo
    env:
      - key: SECRET_KEY
        value: "{{ secret.SECRET_KEY }}"
      - key: DATABASE_URL
        value: "{{ secret.DATABASE_URL }}"
      - key: REDIS_URL
        value: "{{ secret.REDIS_URL }}"
    instance_type: nano
    regions:
      - fra
